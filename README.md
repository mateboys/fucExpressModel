# ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ API

åŸºäº Express.js æ„å»ºçš„ç°ä»£åŒ–ç”µå•†åå° API æœåŠ¡ï¼Œé‡‡ç”¨ ES Modules è§„èŒƒã€‚

## æŠ€æœ¯æ ˆ

- Node.js >= 14
- Express.js
- MySQL
- PM2 (è¿›ç¨‹ç®¡ç†)
- JWT (è®¤è¯)
- ESM (ES Modules)

## é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ ç°ä»£åŒ–çš„ ES Modules é¡¹ç›®ç»“æ„
- ğŸ” JWT èº«ä»½è®¤è¯
- ğŸŒ ç»Ÿä¸€çš„ API å“åº”æ ¼å¼
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ğŸ“ è¯¦ç»†çš„æ—¥å¿—è®°å½•
- ğŸ”§ çµæ´»çš„ç¯å¢ƒé…ç½®
- ğŸš¦ å¤šè¿›ç¨‹å’Œè´Ÿè½½å‡è¡¡ (PM2)

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.js     # åŸºç¡€è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ users.js     # ç”¨æˆ·ç›¸å…³è·¯ç”±
â”‚   â”‚   â””â”€â”€ products.js  # å•†å“ç›¸å…³è·¯ç”±
â”‚   â”œâ”€â”€ middlewares/     # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ errorHandler.js
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ response.js  # å“åº”æ ¼å¼åŒ–
â”œâ”€â”€ public/             # é™æ€èµ„æº
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ www.js          # åº”ç”¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ ecosystem.config.cjs # PM2 é…ç½®æ–‡ä»¶
â”œâ”€â”€ app.js              # åº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 14
- MySQL >= 5.7
- PM2 (ç”¨äºç”Ÿäº§ç¯å¢ƒ)

### å¼€å‘ç¯å¢ƒ

1. **å…‹éš†é¡¹ç›®**
```bash
git clone [é¡¹ç›®åœ°å€]
cd [é¡¹ç›®ç›®å½•]
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡
```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **å®‰è£… PM2**
```bash
sudo npm install -g pm2
```

2. **å®‰è£…ç”Ÿäº§ä¾èµ–**
```bash
npm install --production
```

3. **é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡**
```bash
# åˆ›å»ºå¹¶ç¼–è¾‘ç”Ÿäº§ç¯å¢ƒé…ç½®
cp .env.example .env
```

4. **å¯åŠ¨æœåŠ¡**
```bash
npm run start  #å¯åŠ¨å®ä¾‹(å•è¿›ç¨‹) ç¬¬ä¸€ç§æ–¹å¼
npm run prod:start  # å¯åŠ¨æ‰€æœ‰å®ä¾‹(å¤šè¿›ç¨‹ PM2)  ç¬¬äºŒç§æ–¹å¼
```

### PM2 ç®¡ç†å‘½ä»¤

```bash
npm run prod:start    # å¯åŠ¨æœåŠ¡
npm run prod:stop     # åœæ­¢æœåŠ¡
npm run prod:restart  # é‡å¯æœåŠ¡
npm run prod:logs     # æŸ¥çœ‹æ—¥å¿—
npm run prod:monitor  # ç›‘æ§é¢æ¿
```

## API å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€çš„æ ¼å¼ï¼š

```javascript
{
  "code": 200,          // çŠ¶æ€ç 
  "message": "success", // å“åº”æ¶ˆæ¯
  "data": {            // å“åº”æ•°æ®
    // ... å…·ä½“æ•°æ®
  }
}
```

### çŠ¶æ€ç è¯´æ˜

- 200: æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: æœªæˆæƒ
- 403: ç¦æ­¢è®¿é—®
- 404: èµ„æºä¸å­˜åœ¨
- 409: èµ„æºå†²çª
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨ \`.env\` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
DB_NAME=your_database

# JWT é…ç½®
JWT_SECRET=your_jwt_secret
JWT_EXPIRES_IN=24h

# è·¨åŸŸé…ç½®
CORS_ORIGIN=http://localhost:3000
```

## API è·¯ç”±

### åŸºç¡€è·¯ç”±
- `GET /api/health` - å¥åº·æ£€æŸ¥
- `GET /api/version` - è·å– API ç‰ˆæœ¬

### ç”¨æˆ·è·¯ç”±
- `POST /api/users/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/users/login` - ç”¨æˆ·ç™»å½•
- `GET /api/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### å•†å“è·¯ç”±
- `GET /api/products` - è·å–å•†å“åˆ—è¡¨
- `POST /api/products` - åˆ›å»ºå•†å“
- `GET /api/products/:id` - è·å–å•†å“è¯¦æƒ…
- `PUT /api/products/:id` - æ›´æ–°å•†å“
- `DELETE /api/products/:id` - åˆ é™¤å•†å“

## æ€§èƒ½ä¼˜åŒ–

### å¤šè¿›ç¨‹å¤„ç†
- ä½¿ç”¨ PM2 cluster æ¨¡å¼
- è‡ªåŠ¨ä½¿ç”¨æ‰€æœ‰å¯ç”¨ CPU æ ¸å¿ƒ
- è´Ÿè½½å‡è¡¡å¤„ç†è¯·æ±‚
- è¿›ç¨‹å´©æºƒè‡ªåŠ¨é‡å¯

### é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç”Ÿäº§ç¯å¢ƒéšè—æ•æ„Ÿä¿¡æ¯

### å®‰å…¨æªæ–½
- ä½¿ç”¨ helmet ä¸­é—´ä»¶
- JWT è®¤è¯
- CORS ä¿æŠ¤
- ç¯å¢ƒå˜é‡éš”ç¦»

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç®¡ç†
- é”™è¯¯æ—¥å¿—: `logs/error.log`
- è®¿é—®æ—¥å¿—: `logs/out.log`
- ä½¿ç”¨ `npm run prod:logs` æŸ¥çœ‹å®æ—¶æ—¥å¿—

### æ€§èƒ½ç›‘æ§
- ä½¿ç”¨ `npm run prod:monitor` æŸ¥çœ‹ï¼š
  - CPU ä½¿ç”¨ç‡
  - å†…å­˜ä½¿ç”¨
  - è¯·æ±‚å“åº”æ—¶é—´
  - é”™è¯¯ç‡ç»Ÿè®¡

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ”¹åŠ¨ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

## License

MIT License - è¯¦è§ LICENSE æ–‡ä»¶ 